아래는 **GK-2A 위성의 SWRAD(Solar Radiation) 제품**에 포함된 주요 변수(ASR, DSR, RSR 등)가 어떤 물리적 의미를 가지는지, 그리고 이 데이터를 시각화할 때 어떤 방식으로 접근하는지가 정리된 설명입니다. 이 파일이 **어떤 데이터**를 담고 있고, **시각화 포인트**가 무엇인지 이해하면, 단순히 GeoTIFF로 변환해 지도에 올리는 것 이상으로 기상·기후 해석에 도움을 줄 수 있습니다.

---

# 1. 이 NetCDF 파일에 들어있는 것: SWRAD (단파복사) 자료

**파일명**: `gk2a_ami_le2_swrad_ko020lc_202412110800.nc`  
- `SWRAD`는 **단파복사(Shortwave Radiation)**를 의미.  
- `GK2A_AMI`는 대한민국 정지궤도 위성 GK-2A의 `Advanced Meteorological Imager` 장비를 사용한다는 뜻.

**목적**: 태양으로부터 오는 **단파복사(짧은 파장영역, 약 0.2~4μm)를 지표나 대기에서 얼마나 흡수·반사·하향**되는지를 관측/추정한 산출물.

## 주요 변수
1. **ASR** (Absorbed Shortwave Radiation)  
   - **의미**: 지표 및 대기에서 **흡수된** 태양복사의 양 (W/m²).  
   - scale_factor=0.1 → 실제값 = raw × 0.1  
   - 예: raw=200 → 20 W/m²  
   - ASR이 높으면 해당 지역이 태양복사를 많이 흡수, 지표가 가열됨을 의미.

2. **DSR** (Downward Shortwave Radiation)  
   - **의미**: 지표면에 도달하는 **하향 단파복사량** (W/m²).  
   - 태양 고도가 높을수록, 구름이 적을수록 DSR이 커짐.  
   - scale_factor=0.1, valid range= 0~1500 W/m²(실제).

3. **RSR** (Reflected Shortwave Radiation)  
   - **의미**: 지표나 구름 등에 의해 **반사된** 태양복사량 (W/m²).  
   - scale_factor=0.1, valid range=0~1300 W/m².  
   - 지표 반사도(알베도)가 큰 지역(눈 덮인 표면 등)은 RSR이 커짐.

4. **DQF**(Data Quality Flag) 변수들  
   - **ASR_DQF1, DSR_DQF1, RSR_DQF1**: 각 변수별 픽셀 품질 플래그(0=Bad, 1=Good).  
   - **SW_DQF**: 단파복사 각도 품질 (태양고도, 위성관측각 등).  
   - 시각화나 분석 시 **Bad(0)**인 픽셀을 마스킹 처리 → 신뢰도 높은 영역만 남긴다.

---

# 2. 왜 이런 변수들이 필요한가?

- **단파복사(Shortwave Radiation)**는 태양 복사를 의미하며, 기상/기후에서 **에너지 수지(energy budget)**를 파악하는 핵심 지표.
- **ASR(흡수)**, **DSR(하향)**, **RSR(반사)**를 알고 나면 지구/대기/지표 상호작용에서 태양복사가 어느 정도 흡수·반사·도달하는지 알 수 있음.
- 기상청·기후 연구에서 **복사 수지**를 분석하여 날씨, 기후변화, 대기 열수지 등에 활용.

---

# 3. 시각화, 어떻게 해야 하나?

## 3.1 단일 변수별로 컬러맵

1. **ASR**:
   - 0~1200 W/m² 분포 예상.  
   - 컬러맵: 예) 파란색(낮은 값)→노란색→빨간색(높은 값).  
   - 지표에서 실제로 흡수된 태양복사량이 어느 지역이 큰지 한눈에 파악 가능.

2. **DSR**:
   - 같은 방법으로 0~1500 W/m²를 스케일 범위로 색상화.  
   - 이 값이 크면 태양이 강하게 지표에 도달하는 지역(맑은 하늘, 낮 시간대).

3. **RSR**:
   - 0~1300 W/m² 컬러맵.  
   - 대기나 지표에 의해 반사된 복사량. 구름이 흰색으로 보이는 원인도 반사 광량이 많아서.

## 3.2 DQF 처리

- **DQF=0** → Bad, 시각적으로 투명/회색/마스킹 처리.  
- **DQF=1** → Good, 실제 값 사용.  
- 최종적으로 NaN 처리된 픽셀은 지도에서 흐린색(회색) 등으로 표시해, 품질 나쁜 영역을 구분.

## 3.3 실제 지도에 어떻게 오버레이?

- **NetCDF**: LCC 좌표 → Python (rioxarray)로 WGS84 재투영, scale_factor 적용, DQF 마스킹. → GeoTIFF.  
- **GeoTIFF**: 브라우저에서 loaders.gl로 로딩 → deck.gl `BitmapLayer`로 MapLibre 위에 표시.

---

# 4. 파일 내 메타데이터와 단위 해석

```
ushort ASR(dim_y=900, dim_x=900);
  :scale_factor = 0.1f;
  :units = "W/m2";
  :valid_max = 12000US; // => 실제 12000*0.1=1200 W/m²
  :valid_min = 0US;
  ...
```
- **raw** 값 범위: 0 ~12000 (ushort)  
- **실제물리값**: 0~1200 W/m²  
- DQF에 따라 0 이하나 1200 초과는 Bad로 처리.

같은 패턴으로 DSR, RSR 등이 존재:
- DSR → 0~1500 W/m²  
- RSR → 0~1300 W/m²  

**SW_DQF**: 전체 단파복사 각도(태양천정각 등) 품질 플래그(0=bad).

---

# 5. 데이터 사용 예시 시나리오

- **일사량 지도가 필요**:  
  - DSR(지표 도달 단파복사량) 시각화를 통해 일사량이 강한 지역(맑고 태양고도 높은 곳) 식별.
- **에너지 수지 분석**:  
  - RSR(반사량)이 높으면 알베도가 큰 표면(눈, 구름). ASR(흡수량)이 높으면 열을 많이 흡수하는 지표.
- **기상학적 해석**:  
  - SZA(태양천정각)이 큰 새벽/저녁 시점엔 DQF=0(나쁨)으로 처리 가능성↑.

---

# 6. 결론: 시각화 개요

1. **ASR**를 시각화할 때:
   - 픽셀 값 = 흡수된 태양복사 (W/m²).  
   - 컬러맵 범위: 0~1200.  
   - Bad 플래그(ASR_DQF1=0)는 마스킹.
2. **지도 연동**:  
   - Lambert Conformal Conic → reproject → WGS84.  
   - GeoTIFF → deck.gl BitmapLayer.  
   - 결과: 한반도(또는 더 넓은 범위)에 대해, 각 격자가 흡수된 일사량을 색으로 보여줌.
3. **데이터 활용**:
   - 날씨 시뮬레이션, 태양광 발전 분석, 구름 분포와 함께 해석 가능.
4. **기술 관점**:
   - NetCDF 파싱 → DQF/scale_factor 적용 → GeoTIFF 변환  
   - 프론트엔드: loaders.gl + deck.gl로 렌더.

---

## 요약

- **ASR**: 흡수된 단파복사량, 0~1200 W/m².  
- **DSR**: 지표면에 도달하는 하향단파복사, 0~1500 W/m².  
- **RSR**: 반사된 단파복사, 0~1300 W/m².  
- **DQF**: 품질 플래그(0=bad, 1=good).  
- **시각화**: DQF=1인 픽셀만 골라 컬러맵 적용. LCC → WGS84로 재투영 후 GeoTIFF로 만든 뒤 지도에 오버레이.  